{% extends "base.html" %}

{% block title %}Harvest Sales - Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Harvest Sale Submissions</h1>
    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i> Dashboard
    </a>
</div>

<div class="tabs">
    <button class="tab-btn active" onclick="filterSales('all', event)">All</button>
    <button class="tab-btn" onclick="filterSales('pending', event)">Pending</button>
    <button class="tab-btn" onclick="filterSales('approved', event)">Approved</button>
    <button class="tab-btn" onclick="filterSales('rejected', event)">Rejected</button>
</div>

{% if sales %}
<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>Farmer</th>
                <th>Crop</th>
                <th>Location</th>
                <th>Cultivated Area</th>
                <th>Yield Quantity</th>
                <th>Selling Qty</th>
                <th>Approval ID</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for sale in sales %}
            <tr class="sale-row" data-status="{{ sale.status }}">
                <td>
                    <strong>{{ sale.farmer.name }}</strong><br>
                    <small>{{ sale.contact_number or sale.farmer.mobile }}</small>
                </td>
                <td><strong>{{ sale.cultivation.crop_name }}</strong></td>
                <td>
                    {{ sale.cultivation.land.village or '' }}
                    {{ sale.cultivation.land.district or 'N/A' }}
                </td>
                <td>{{ sale.cultivation.area_used }} acres</td>
                <td>{{ sale.actual_yield_quantity }} {{ sale.yield_unit }}</td>
                <td>
                    {{ sale.selling_quantity }} {{ sale.yield_unit }}
                    {% if sale.approved_quantity %}
                        <br><small>Approved: {{ sale.approved_quantity }}</small>
                    {% endif %}
                </td>
                <td><code>{{ sale.cultivation.cultivation_approval_id }}</code></td>
                <td>
                    <span class="badge badge-{{ 'warning' if sale.status == 'pending' else ('success' if sale.status == 'approved' else 'error') }}">
                        {{ sale.status.title() }}
                    </span>
                </td>
                <td>
                    <a href="{{ url_for('admin.view_harvest_sale', sale_id=sale.id) }}" class="btn btn-sm">
                        <i class="fas fa-eye"></i> View
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="card text-center">
    <i class="fas fa-inbox fa-3x" style="opacity: 0.3; margin-bottom: 1rem;"></i>
    <h3>No Harvest Sales</h3>
    <p>Harvest sale submissions from farmers will appear here.</p>
</div>
{% endif %}

<script>
function filterSales(status, event) {
    const rows = document.querySelectorAll('.sale-row');
    const buttons = document.querySelectorAll('.tab-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    if (event && event.target) {
        event.target.classList.add('active');
    }
    
    rows.forEach(row => {
        if (status === 'all' || row.dataset.status === status) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
