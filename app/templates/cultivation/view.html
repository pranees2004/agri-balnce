{% extends "base.html" %}

{% block title %}{{ cultivation.crop_name }} - AgriBalance{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">{{ cultivation.crop_name }}</h1>
    <span class="badge badge-{{ 'success' if cultivation.status == 'harvested' else 'warning' if cultivation.status == 'active' else 'error' if cultivation.status == 'failed' else 'info' }}" style="font-size: 1rem; padding: 8px 16px;">
        {{ cultivation.status.title() }}
    </span>
</div>

<div class="grid-2">
    <div class="card">
        <h3 class="card-title mb-20">Cultivation Details</h3>
        
        <div class="list-item">
            <span>Crop</span>
            <strong>{{ cultivation.crop_name }}</strong>
        </div>
        
        {% if cultivation.variety %}
        <div class="list-item">
            <span>Variety</span>
            <strong>{{ cultivation.variety }}</strong>
        </div>
        {% endif %}
        
        <div class="list-item">
            <span>Land</span>
            <strong><a href="{{ url_for('land.view_land', land_id=cultivation.land.id) }}">{{ cultivation.land.name }}</a></strong>
        </div>
        
        {% if cultivation.planting_date %}
        <div class="list-item">
            <span>Planting Date</span>
            <strong>{{ cultivation.planting_date.strftime('%d %B %Y') }}</strong>
        </div>
        {% endif %}
        
        {% if cultivation.expected_harvest_date %}
        <div class="list-item">
            <span>Expected Harvest</span>
            <strong>{{ cultivation.expected_harvest_date.strftime('%d %B %Y') }}</strong>
        </div>
        {% endif %}
        
        {% if cultivation.actual_harvest_date %}
        <div class="list-item">
            <span>Actual Harvest</span>
            <strong>{{ cultivation.actual_harvest_date.strftime('%d %B %Y') }}</strong>
        </div>
        {% endif %}
        
        {% if cultivation.actual_yield %}
        <div class="list-item">
            <span>Yield</span>
            <strong>{{ cultivation.actual_yield }} {{ cultivation.yield_unit }}</strong>
        </div>
        {% endif %}
        
        {% if cultivation.notes %}
        <div class="mt-20">
            <strong>Notes:</strong>
            <p>{{ cultivation.notes }}</p>
        </div>
        {% endif %}
        
        <!-- Status Update -->
        {% if cultivation.status != 'harvested' and cultivation.status != 'failed' %}
        <div class="mt-20">
            <h4 class="mb-10">Update Status</h4>
            <form method="POST" action="{{ url_for('cultivation.update_status', cultivation_id=cultivation.id) }}" class="flex gap-10">
                <select name="status" class="form-control">
                    <option value="planned" {{ 'selected' if cultivation.status == 'planned' else '' }}>Planned</option>
                    <option value="active" {{ 'selected' if cultivation.status == 'active' else '' }}>Active</option>
                    <option value="harvested">Harvested</option>
                    <option value="failed">Failed</option>
                </select>
                <input type="number" name="actual_yield" class="form-control" placeholder="Yield (if harvested)" step="0.1">
                <button type="submit" class="btn btn-primary">Update</button>
            </form>
        </div>
        {% endif %}
        
        {% if cultivation.status == 'harvested' %}
        <div class="mt-20">
            <a href="{{ url_for('selling.add_listing') }}" class="btn btn-secondary btn-block">
                <i class="fas fa-store"></i> Sell This Crop
            </a>
        </div>
        {% endif %}
    </div>
    
    <div class="card">
        <h3 class="card-title mb-20">
            <i class="fas fa-robot"></i> AI Recommendations
        </h3>
        
        {% if recommendations %}
        <div class="recommendations">
            <div class="recommendation-section">
                <h5><i class="fas fa-leaf"></i> Suitable Crops</h5>
                <ul>
                    {% for crop in recommendations.suitable_crops %}
                    <li>{{ crop }}</li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="recommendation-section">
                <h5><i class="fas fa-calendar-alt"></i> Cultivation Time</h5>
                <p>{{ recommendations.cultivation_time }}</p>
            </div>
            
            <div class="recommendation-section">
                <h5><i class="fas fa-tasks"></i> Management Steps</h5>
                <ul>
                    {% for step in recommendations.management_steps %}
                    <li>{{ step }}</li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="recommendation-section">
                <h5><i class="fas fa-flask"></i> Nutrient Guidance</h5>
                <ul>
                    {% for item in recommendations.nutrient_guidance %}
                    <li>{{ item }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-info-circle"></i>
            <p>No recommendations stored for this cultivation.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
